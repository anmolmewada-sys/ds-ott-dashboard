<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTT Intelligence Hub - WebEngage Data Science</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo } = React;
        const { LineChart, Line, BarChart, Bar, ScatterChart, Scatter, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Cell, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, ComposedChart } = Recharts;

        // Simple icon components
        const TrendingUp = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>
            </svg>
        );
        
        const TrendingDown = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/>
            </svg>
        );
        
        const Users = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
        );
        
        const DollarSign = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
        );
        
        const Zap = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
            </svg>
        );

        const OTTDataScienceDashboard = () => {
            const [activeTab, setActiveTab] = useState('summary');
            const [dateRange, setDateRange] = useState('30d');
            const [platform, setPlatform] = useState('all');
            const [region, setRegion] = useState('all');
            const [plan, setPlan] = useState('all');

            const tabs = [
                { id: 'summary', label: 'Summary' },
                { id: 'derived', label: 'Derived Attributes' },
                { id: 'cohort', label: 'Cohort Analysis' },
                { id: 'content', label: 'Content Analysis' },
                { id: 'engagement', label: 'Engagement Insights' },
                { id: 'rfm', label: 'RFM Segmentation' }
            ];

            const generateData = useMemo(() => {
                const baseMultiplier = {
                    platform: { 'Netflix': 1.2, 'Prime Video': 1.1, 'Disney+': 0.9, 'Hulu': 0.85, 'all': 1 },
                    region: { 'North America': 1.3, 'Europe': 1.1, 'Asia Pacific': 0.95, 'Latin America': 0.8, 'all': 1 },
                    plan: { 'Basic': 0.7, 'Standard': 1.0, 'Premium': 1.4, 'all': 1 }
                };

                const mult = baseMultiplier.platform[platform] * baseMultiplier.region[region] * baseMultiplier.plan[plan];

                const cohortData = Array.from({ length: 12 }, (_, i) => ({
                    week: `W${i + 1}`,
                    retention: Math.max(15, 100 - (i * 8 * (1 / mult))),
                    predicted: Math.max(10, 95 - (i * 7 * (1 / mult))),
                    benchmark: Math.max(12, 90 - (i * 9))
                }));

                const churnData = [
                    { risk: 'Low', count: Math.floor(45000 * mult), color: '#10b981' },
                    { risk: 'Medium', count: Math.floor(28000 * mult), color: '#f59e0b' },
                    { risk: 'High', count: Math.floor(12000 * mult), color: '#ef4444' },
                    { risk: 'Critical', count: Math.floor(5000 * mult), color: '#991b1b' }
                ];

                const contentData = [
                    { category: 'Drama', engagement: 92 * mult, retention: 88, watchHours: 12800, completion: 72, avod: 42, svod: 58 },
                    { category: 'Action', engagement: 87 * mult, retention: 82, watchHours: 10350, completion: 78, avod: 30, svod: 70 },
                    { category: 'Comedy', engagement: 79 * mult, retention: 75, watchHours: 8100, completion: 69, avod: 45, svod: 55 },
                    { category: 'Thriller', engagement: 85 * mult, retention: 80, watchHours: 9200, completion: 74, avod: 38, svod: 62 },
                    { category: 'Kids', engagement: 73 * mult, retention: 71, watchHours: 8900, completion: 83, avod: 55, svod: 45 },
                    { category: 'Sports', engagement: 81 * mult, retention: 77, watchHours: 7800, completion: 64, avod: 62, svod: 38 }
                ];

                const heatmapData = [];
                const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                days.forEach(day => {
                    for (let hour = 0; hour < 24; hour++) {
                        const baseIntensity = hour >= 18 && hour <= 23 ? 80 : hour >= 12 && hour <= 17 ? 60 : 40;
                        const weekendBoost = (day === 'Sat' || day === 'Sun') ? 15 : 0;
                        heatmapData.push({
                            day,
                            hour,
                            intensity: Math.min(100, (baseIntensity + weekendBoost + Math.random() * 20) * mult)
                        });
                    }
                });

                const dauData = Array.from({ length: 30 }, (_, i) => ({
                    day: i + 1,
                    dau: Math.floor((150000 + Math.sin(i / 3.5) * 35000) * mult),
                    wau: Math.floor((420000 + Math.sin(i / 3.5) * 50000) * mult),
                    mau: Math.floor((1240000 + Math.sin(i / 3.5) * 80000) * mult)
                }));

                const derivedAttribData = [
                    { level: 'High', binge: Math.floor(35000 * mult), completion: Math.floor(28000 * mult) },
                    { level: 'Medium', binge: Math.floor(52000 * mult), completion: Math.floor(48000 * mult) },
                    { level: 'Low', binge: Math.floor(28000 * mult), completion: Math.floor(32000 * mult) }
                ];

                const signalRadarData = [
                    { attribute: 'Binge', value: 85 * mult, fullMark: 100 },
                    { attribute: 'Completion', value: 78 * mult, fullMark: 100 },
                    { attribute: 'Night', value: 72 * mult, fullMark: 100 },
                    { attribute: 'TV', value: 65 * mult, fullMark: 100 }
                ];

                const featureImportance = [
                    { feature: 'Recency', importance: 95 },
                    { feature: 'Genre Affinity', importance: 87 },
                    { feature: 'Device', importance: 73 },
                    { feature: 'Watch Time', importance: 68 },
                    { feature: 'Night Owl', importance: 61 },
                    { feature: 'Price Sensitivity', importance: 54 }
                ];

                const genreTransition = [];
                const genres = ['Drama', 'Action', 'Comedy', 'Thriller', 'Kids', 'Sports'];
                genres.forEach(from => {
                    genres.forEach(to => {
                        const probability = from === to ? 0.4 : 0.1 + Math.random() * 0.15;
                        genreTransition.push({ from, to, value: probability * 100 });
                    });
                });

                const rfmData = [
                    { segment: 'Champions', x: 85, y: 90, size: 14, color: '#8b5cf6' },
                    { segment: 'Loyal', x: 72, y: 65, size: 22, color: '#06b6d4' },
                    { segment: 'Promising', x: 55, y: 75, size: 10, color: '#f59e0b' },
                    { segment: 'At Risk', x: 45, y: 35, size: 16, color: '#ef4444' },
                    { segment: 'Hibernating', x: 25, y: 20, size: 18, color: '#6366f1' },
                    { segment: 'Need Attention', x: 68, y: 45, size: 9, color: '#10b981' },
                    { segment: 'Lost', x: 15, y: 15, size: 11, color: '#94a3b8' }
                ];

                const languageMix = [
                    { language: 'English', value: 42, color: '#8b5cf6' },
                    { language: 'Spanish', value: 18, color: '#06b6d4' },
                    { language: 'Hindi', value: 15, color: '#10b981' },
                    { language: 'French', value: 12, color: '#f59e0b' },
                    { language: 'Korean', value: 8, color: '#ef4444' },
                    { language: 'Others', value: 5, color: '#6366f1' }
                ];

                const dropOffData = Array.from({ length: 10 }, (_, i) => ({
                    episode: i + 1,
                    completion: Math.max(25, 95 - i * 8 - Math.random() * 5)
                }));

                const cohortRetentionData = Array.from({ length: 8 }, (_, i) => ({
                    week: `W${i + 1}`,
                    retention: Math.max(30, 100 - i * 10 - Math.random() * 5)
                }));

                return {
                    cohortData, churnData, contentData, heatmapData, dauData, derivedAttribData,
                    signalRadarData, featureImportance, genreTransition, rfmData, languageMix,
                    dropOffData, cohortRetentionData
                };
            }, [dateRange, platform, region, plan]);

            const { cohortData, churnData, contentData, heatmapData, dauData, derivedAttribData,
                    signalRadarData, featureImportance, genreTransition, rfmData, languageMix,
                    dropOffData, cohortRetentionData } = generateData;

            const kpis = [
                { label: 'Predicted Churn', value: '14.2%', change: -2.3, icon: TrendingDown, color: 'text-green-600' },
                { label: 'LTV Forecast', value: '$287', change: 8.4, icon: DollarSign, color: 'text-blue-600' },
                { label: 'Engagement', value: '8.3/10', change: 1.2, icon: Zap, color: 'text-purple-600' },
                { label: 'Active Users', value: '1.24M', change: 5.7, icon: Users, color: 'text-indigo-600' }
            ];

            const renderSummaryTab = () => (
                <div className="space-y-4 md:space-y-6">
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                        {kpis.map((kpi, idx) => (
                            <div key={idx} className="bg-white p-4 rounded-lg shadow-sm">
                                <div className="flex items-center justify-between mb-2">
                                    <kpi.icon className={`w-6 h-6 ${kpi.color}`} />
                                    <span className={`flex items-center text-xs font-semibold ${kpi.change > 0 ? 'text-green-600' : 'text-red-600'}`}>
                                        {kpi.change > 0 ? <TrendingUp className="w-3 h-3 mr-0.5" /> : <TrendingDown className="w-3 h-3 mr-0.5" />}
                                        {Math.abs(kpi.change)}%
                                    </span>
                                </div>
                                <div className="text-xl md:text-2xl font-bold text-slate-800">{kpi.value}</div>
                                <div className="text-xs text-slate-600">{kpi.label}</div>
                            </div>
                        ))}
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                        <div className="bg-white p-4 rounded-lg shadow-sm">
                            <h3 className="text-sm md:text-base font-bold text-slate-800 mb-3">Cohort Retention Analysis</h3>
                            <ResponsiveContainer width="100%" height={220}>
                                <LineChart data={cohortData}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                    <XAxis dataKey="week" stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
                                    <Legend wrapperStyle={{ fontSize: '10px' }} />
                                    <Line type="monotone" dataKey="retention" stroke="#3b82f6" strokeWidth={2} name="Actual" dot={false} />
                                    <Line type="monotone" dataKey="predicted" stroke="#8b5cf6" strokeWidth={2} strokeDasharray="5 5" name="ML Prediction" dot={false} />
                                    <Line type="monotone" dataKey="benchmark" stroke="#94a3b8" strokeWidth={1} name="Benchmark" dot={false} />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>

                        <div className="bg-white p-4 rounded-lg shadow-sm">
                            <h3 className="text-sm md:text-base font-bold text-slate-800 mb-3">Churn Risk Distribution</h3>
                            <ResponsiveContainer width="100%" height={220}>
                                <BarChart data={churnData}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                    <XAxis dataKey="risk" stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
                                    <Bar dataKey="count" name="Users" radius={[8, 8, 0, 0]}>
                                        {churnData.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={entry.color} />
                                        ))}
                                    </Bar>
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow-sm">
                        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-3">Daily Active Users - 30 Day Trend</h3>
                        <ResponsiveContainer width="100%" height={220}>
                            <ComposedChart data={dauData}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                <XAxis dataKey="day" stroke="#64748b" style={{ fontSize: '10px' }} />
                                <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
                                <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
                                <Legend wrapperStyle={{ fontSize: '10px' }} />
                                <Line type="monotone" dataKey="dau" stroke="#8b5cf6" strokeWidth={3} name="DAU" dot={false} />
                                <Line type="monotone" dataKey="wau" stroke="#06b6d4" strokeWidth={2} name="WAU" dot={false} strokeDasharray="5 5" />
                                <Line type="monotone" dataKey="mau" stroke="#f59e0b" strokeWidth={2} name="MAU" dot={false} strokeDasharray="3 3" />
                            </ComposedChart>
                        </ResponsiveContainer>
                    </div>
                </div>
            );

            const renderDerivedTab = () => (
                <div className="space-y-4 md:space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                        <div className="bg-white p-4 rounded-lg shadow-sm">
                            <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Derived Attributes</h3>
                            <p className="text-xs text-slate-600 mb-4">Binge propensity & completion rate</p>
                            <ResponsiveContainer width="100%" height={250}>
                                <BarChart data={derivedAttribData}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                    <XAxis dataKey="level" stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
                                    <Legend wrapperStyle={{ fontSize: '10px' }} />
                                    <Bar dataKey="binge" fill="#8b5cf6" radius={[8, 8, 0, 0]} name="Binge Propensity" />
                                    <Bar dataKey="completion" fill="#f59e0b" radius={[8, 8, 0, 0]} name="Completion Rate" />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>

                        <div className="bg-white p-4 rounded-lg shadow-sm">
                            <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Signal Radar</h3>
                            <p className="text-xs text-slate-600 mb-4">Composite persona-strength view</p>
                            <ResponsiveContainer width="100%" height={250}>
                                <RadarChart data={signalRadarData}>
                                    <PolarGrid stroke="#e2e8f0" />
                                    <PolarAngleAxis dataKey="attribute" style={{ fontSize: '10px' }} />
                                    <PolarRadiusAxis angle={90} domain={[0, 100]} style={{ fontSize: '10px' }} />
                                    <Radar name="Strength" dataKey="value" stroke="#8b5cf6" fill="#8b5cf6" fillOpacity={0.6} strokeWidth={2} />
                                    <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
                                </RadarChart>
                            </ResponsiveContainer>
                        </div>

                        <div className="bg-white p-4 rounded-lg shadow-sm">
                            <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Feature Importance</h3>
                            <p className="text-xs text-slate-600 mb-4">Drivers of watch-hour (modeled)</p>
                            <ResponsiveContainer width="100%" height={250}>
                                <BarChart data={featureImportance} layout="vertical">
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                    <XAxis type="number" stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <YAxis dataKey="feature" type="category" stroke="#64748b" style={{ fontSize: '9px' }} width={85} />
                                    <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
                                    <Bar dataKey="importance" fill="#06b6d4" radius={[0, 8, 8, 0]} />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    <div className="bg-white p-4 rounded-lg shadow-sm">
                        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Completion vs Binge</h3>
                        <p className="text-xs text-slate-600 mb-4">Per-persona scatter with axis labels</p>
                        <ResponsiveContainer width="100%" height={280}>
                            <ScatterChart>
                                <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                <XAxis type="number" dataKey="completion" name="Completion %" stroke="#64748b" style={{ fontSize: '10px' }} />
                                <YAxis type="number" dataKey="retention" name="Binge %" stroke="#64748b" style={{ fontSize: '10px' }} />
                                <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
                                <Scatter name="Content" data={contentData} fill="#8b5cf6">
                                    {contentData.map((entry, index) => (
                                        <Cell key={`cell-${index}`} fill={`hsl(${index * 60}, 70%, 55%)`} />
                                    ))}
                                </Scatter>
                            </ScatterChart>
                        </ResponsiveContainer>
                    </div>
                </div>
            );

            const renderCohortTab = () => (
                <div className="space-y-4 md:space-y-6">
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">DAU Trend</h3>
                        <p className="text-xs text-slate-600 mb-4">Last 30 days with weekend spikes</p>
                        <ResponsiveContainer width="100%" height={280}>
                            <AreaChart data={dauData}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                <XAxis dataKey="day" stroke="#64748b" style={{ fontSize: '10px' }} />
                                <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
                                <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
                                <Legend wrapperStyle={{ fontSize: '10px' }} />
                                <Area type="monotone" dataKey="dau" stroke="#8b5cf6" fill="#8b5cf6" fillOpacity={0.6} strokeWidth={3} name="DAU" />
                            </AreaChart>
                        </ResponsiveContainer>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                        <div className="bg-white p-4 rounded-lg shadow-sm">
                            <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Series Drop-off Curve</h3>
                            <p className="text-xs text-slate-600 mb-4">Episode-wise median completion</p>
                            <ResponsiveContainer width="100%" height={250}>
                                <LineChart data={dropOffData}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                    <XAxis dataKey="episode" stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
                                    <Line type="monotone" dataKey="completion" stroke="#ef4444" strokeWidth={3} dot={{ fill: '#ef4444', r: 5 }} name="Completion %" />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>

                        <div className="bg-white p-4 rounded-lg shadow-sm">
                            <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Cohort Retention (W1-W8)</h3>
                            <p className="text-xs text-slate-600 mb-4">Monthly acquisition cohort</p>
                            <ResponsiveContainer width="100%" height={250}>
                                <LineChart data={cohortRetentionData}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                    <XAxis dataKey="week" stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
                                    <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
                                    <Line type="monotone" dataKey="retention" stroke="#10b981" strokeWidth={3} dot={{ fill: '#10b981', r: 5 }} name="Retention %" />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                </div>
            );

            const renderContentTab = () => (
                <div className="space-y-4 md:space-y-6">
                    <div className="bg-white p-4 rounded-lg shadow-sm">
                        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Genre Share (AVOD vs SVOD)</h3>
                        <p className="text-xs text-slate-600 mb-4">Watch-time share split</p>
                        <ResponsiveContainer width="100%" height={280}>
                            <ComposedChart data={contentData}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                                <XAxis dataKey="category" stroke="#64748b" style={{ fontSize: '10px' }} />
                                <YAxis yAxisId="left" stroke="#64748b" style={{ fontSize: '10px' }} />
                                <YAxis yAxisId="right" orientation="right" stroke="#64748b" style={{ fontSize: '10px' }} />
