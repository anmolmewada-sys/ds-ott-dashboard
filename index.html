import React, { useState, useMemo } from 'react';
import { LineChart, Line, BarChart, Bar, ScatterChart, Scatter, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Cell, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, ComposedChart } from 'recharts';
import { TrendingUp, TrendingDown, Users, DollarSign, Zap, Activity, Target, Clock } from 'lucide-react';

const OTTDataScienceDashboard = () => {
  const [activeTab, setActiveTab] = useState('summary');
  const [dateRange, setDateRange] = useState('30d');
  const [platform, setPlatform] = useState('all');
  const [region, setRegion] = useState('all');
  const [plan, setPlan] = useState('all');

  const tabs = [
    { id: 'summary', label: 'Summary' },
    { id: 'derived', label: 'Derived Attributes' },
    { id: 'cohort', label: 'Cohort Analysis' },
    { id: 'content', label: 'Content Analysis' },
    { id: 'engagement', label: 'Engagement Insights' },
    { id: 'rfm', label: 'RFM Segmentation' }
  ];

  const generateData = useMemo(() => {
    const baseMultiplier = {
      platform: { 'Netflix': 1.2, 'Prime Video': 1.1, 'Disney+': 0.9, 'Hulu': 0.85, 'all': 1 },
      region: { 'North America': 1.3, 'Europe': 1.1, 'Asia Pacific': 0.95, 'Latin America': 0.8, 'all': 1 },
      plan: { 'Basic': 0.7, 'Standard': 1.0, 'Premium': 1.4, 'all': 1 }
    };

    const mult = baseMultiplier.platform[platform] * baseMultiplier.region[region] * baseMultiplier.plan[plan];

    const cohortData = Array.from({ length: 12 }, (_, i) => ({
      week: `W${i + 1}`,
      retention: Math.max(15, 100 - (i * 8 * (1 / mult))),
      predicted: Math.max(10, 95 - (i * 7 * (1 / mult))),
      benchmark: Math.max(12, 90 - (i * 9))
    }));

    const churnData = [
      { risk: 'Low', count: Math.floor(45000 * mult), color: '#10b981' },
      { risk: 'Medium', count: Math.floor(28000 * mult), color: '#f59e0b' },
      { risk: 'High', count: Math.floor(12000 * mult), color: '#ef4444' },
      { risk: 'Critical', count: Math.floor(5000 * mult), color: '#991b1b' }
    ];

    const contentData = [
      { category: 'Drama', engagement: 92 * mult, retention: 88, watchHours: 12800, completion: 72, avod: 42, svod: 58 },
      { category: 'Action', engagement: 87 * mult, retention: 82, watchHours: 10350, completion: 78, avod: 30, svod: 70 },
      { category: 'Comedy', engagement: 79 * mult, retention: 75, watchHours: 8100, completion: 69, avod: 45, svod: 55 },
      { category: 'Thriller', engagement: 85 * mult, retention: 80, watchHours: 9200, completion: 74, avod: 38, svod: 62 },
      { category: 'Kids', engagement: 73 * mult, retention: 71, watchHours: 8900, completion: 83, avod: 55, svod: 45 },
      { category: 'Sports', engagement: 81 * mult, retention: 77, watchHours: 7800, completion: 64, avod: 62, svod: 38 }
    ];

    const heatmapData = [];
    const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    days.forEach(day => {
      for (let hour = 0; hour < 24; hour++) {
        const baseIntensity = hour >= 18 && hour <= 23 ? 80 : hour >= 12 && hour <= 17 ? 60 : 40;
        const weekendBoost = (day === 'Sat' || day === 'Sun') ? 15 : 0;
        heatmapData.push({
          day,
          hour,
          intensity: Math.min(100, (baseIntensity + weekendBoost + Math.random() * 20) * mult)
        });
      }
    });

    const dauData = Array.from({ length: 30 }, (_, i) => ({
      day: i + 1,
      dau: Math.floor((150000 + Math.sin(i / 3.5) * 35000) * mult),
      wau: Math.floor((420000 + Math.sin(i / 3.5) * 50000) * mult),
      mau: Math.floor((1240000 + Math.sin(i / 3.5) * 80000) * mult)
    }));

    const derivedAttribData = [
      { level: 'High', binge: Math.floor(35000 * mult), completion: Math.floor(28000 * mult) },
      { level: 'Medium', binge: Math.floor(52000 * mult), completion: Math.floor(48000 * mult) },
      { level: 'Low', binge: Math.floor(28000 * mult), completion: Math.floor(32000 * mult) }
    ];

    const signalRadarData = [
      { attribute: 'Binge', value: 85 * mult, fullMark: 100 },
      { attribute: 'Completion', value: 78 * mult, fullMark: 100 },
      { attribute: 'Night', value: 72 * mult, fullMark: 100 },
      { attribute: 'TV', value: 65 * mult, fullMark: 100 }
    ];

    const featureImportance = [
      { feature: 'Recency', importance: 95 },
      { feature: 'Genre Affinity', importance: 87 },
      { feature: 'Device', importance: 73 },
      { feature: 'Watch Time', importance: 68 },
      { feature: 'Night Owl', importance: 61 },
      { feature: 'Price Sensitivity', importance: 54 }
    ];

    const genreTransition = [];
    const genres = ['Drama', 'Action', 'Comedy', 'Thriller', 'Kids', 'Sports'];
    genres.forEach(from => {
      genres.forEach(to => {
        const probability = from === to ? 0.4 : 0.1 + Math.random() * 0.15;
        genreTransition.push({ from, to, value: probability * 100 });
      });
    });

    const rfmData = [
      { segment: 'Champions', x: 85, y: 90, size: 14, color: '#8b5cf6' },
      { segment: 'Loyal', x: 72, y: 65, size: 22, color: '#06b6d4' },
      { segment: 'Promising', x: 55, y: 75, size: 10, color: '#f59e0b' },
      { segment: 'At Risk', x: 45, y: 35, size: 16, color: '#ef4444' },
      { segment: 'Hibernating', x: 25, y: 20, size: 18, color: '#6366f1' },
      { segment: 'Need Attention', x: 68, y: 45, size: 9, color: '#10b981' },
      { segment: 'Lost', x: 15, y: 15, size: 11, color: '#94a3b8' }
    ];

    const languageMix = [
      { language: 'English', value: 42, color: '#8b5cf6' },
      { language: 'Spanish', value: 18, color: '#06b6d4' },
      { language: 'Hindi', value: 15, color: '#10b981' },
      { language: 'French', value: 12, color: '#f59e0b' },
      { language: 'Korean', value: 8, color: '#ef4444' },
      { language: 'Others', value: 5, color: '#6366f1' }
    ];

    const dropOffData = Array.from({ length: 10 }, (_, i) => ({
      episode: i + 1,
      completion: Math.max(25, 95 - i * 8 - Math.random() * 5)
    }));

    const cohortRetentionData = Array.from({ length: 8 }, (_, i) => ({
      week: `W${i + 1}`,
      retention: Math.max(30, 100 - i * 10 - Math.random() * 5)
    }));

    return {
      cohortData,
      churnData,
      contentData,
      heatmapData,
      dauData,
      derivedAttribData,
      signalRadarData,
      featureImportance,
      genreTransition,
      rfmData,
      languageMix,
      dropOffData,
      cohortRetentionData
    };
  }, [dateRange, platform, region, plan]);

  const { cohortData, churnData, contentData, heatmapData, dauData, derivedAttribData, signalRadarData, featureImportance, genreTransition, rfmData, languageMix, dropOffData, cohortRetentionData } = generateData;

  const kpis = [
    { label: 'Predicted Churn', value: '14.2%', change: -2.3, icon: TrendingDown, color: 'text-green-600' },
    { label: 'LTV Forecast', value: '$287', change: 8.4, icon: DollarSign, color: 'text-blue-600' },
    { label: 'Engagement', value: '8.3/10', change: 1.2, icon: Zap, color: 'text-purple-600' },
    { label: 'Active Users', value: '1.24M', change: 5.7, icon: Users, color: 'text-indigo-600' }
  ];

  const renderSummaryTab = () => (
    <div className="space-y-4 md:space-y-6">
      <div className="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
        {kpis.map((kpi, idx) => (
          <div key={idx} className="bg-white p-4 rounded-lg shadow-sm">
            <div className="flex items-center justify-between mb-2">
              <kpi.icon className={`w-6 h-6 ${kpi.color}`} />
              <span className={`flex items-center text-xs font-semibold ${kpi.change > 0 ? 'text-green-600' : 'text-red-600'}`}>
                {kpi.change > 0 ? <TrendingUp className="w-3 h-3 mr-0.5" /> : <TrendingDown className="w-3 h-3 mr-0.5" />}
                {Math.abs(kpi.change)}%
              </span>
            </div>
            <div className="text-xl md:text-2xl font-bold text-slate-800">{kpi.value}</div>
            <div className="text-xs text-slate-600">{kpi.label}</div>
          </div>
        ))}
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-3">Cohort Retention Analysis</h3>
          <ResponsiveContainer width="100%" height={220}>
            <LineChart data={cohortData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis dataKey="week" stroke="#64748b" style={{ fontSize: '10px' }} />
              <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
              <Legend wrapperStyle={{ fontSize: '10px' }} />
              <Line type="monotone" dataKey="retention" stroke="#3b82f6" strokeWidth={2} name="Actual" dot={false} />
              <Line type="monotone" dataKey="predicted" stroke="#8b5cf6" strokeWidth={2} strokeDasharray="5 5" name="ML Prediction" dot={false} />
              <Line type="monotone" dataKey="benchmark" stroke="#94a3b8" strokeWidth={1} name="Benchmark" dot={false} />
            </LineChart>
          </ResponsiveContainer>
        </div>

        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-3">Churn Risk Distribution</h3>
          <ResponsiveContainer width="100%" height={220}>
            <BarChart data={churnData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis dataKey="risk" stroke="#64748b" style={{ fontSize: '10px' }} />
              <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
              <Bar dataKey="count" name="Users" radius={[8, 8, 0, 0]}>
                {churnData.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={entry.color} />
                ))}
              </Bar>
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>

      <div className="bg-white p-4 rounded-lg shadow-sm">
        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-3">Daily Active Users - 30 Day Trend</h3>
        <ResponsiveContainer width="100%" height={220}>
          <ComposedChart data={dauData}>
            <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
            <XAxis dataKey="day" stroke="#64748b" style={{ fontSize: '10px' }} />
            <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
            <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
            <Legend wrapperStyle={{ fontSize: '10px' }} />
            <Line type="monotone" dataKey="dau" stroke="#8b5cf6" strokeWidth={3} name="DAU" dot={false} />
            <Line type="monotone" dataKey="wau" stroke="#06b6d4" strokeWidth={2} name="WAU" dot={false} strokeDasharray="5 5" />
            <Line type="monotone" dataKey="mau" stroke="#f59e0b" strokeWidth={2} name="MAU" dot={false} strokeDasharray="3 3" />
          </ComposedChart>
        </ResponsiveContainer>
      </div>
    </div>
  );

  const renderDerivedTab = () => (
    <div className="space-y-4 md:space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Derived Attributes</h3>
          <p className="text-xs text-slate-600 mb-4">Binge propensity & completion rate</p>
          <ResponsiveContainer width="100%" height={250}>
            <BarChart data={derivedAttribData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis dataKey="level" stroke="#64748b" style={{ fontSize: '10px' }} />
              <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
              <Legend wrapperStyle={{ fontSize: '10px' }} />
              <Bar dataKey="binge" fill="#8b5cf6" radius={[8, 8, 0, 0]} name="Binge Propensity" />
              <Bar dataKey="completion" fill="#f59e0b" radius={[8, 8, 0, 0]} name="Completion Rate" />
            </BarChart>
          </ResponsiveContainer>
        </div>

        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Signal Radar</h3>
          <p className="text-xs text-slate-600 mb-4">Composite persona-strength view</p>
          <ResponsiveContainer width="100%" height={250}>
            <RadarChart data={signalRadarData}>
              <PolarGrid stroke="#e2e8f0" />
              <PolarAngleAxis dataKey="attribute" style={{ fontSize: '10px' }} />
              <PolarRadiusAxis angle={90} domain={[0, 100]} style={{ fontSize: '10px' }} />
              <Radar name="Strength" dataKey="value" stroke="#8b5cf6" fill="#8b5cf6" fillOpacity={0.6} strokeWidth={2} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
            </RadarChart>
          </ResponsiveContainer>
        </div>

        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Feature Importance</h3>
          <p className="text-xs text-slate-600 mb-4">Drivers of watch-hour (modeled)</p>
          <ResponsiveContainer width="100%" height={250}>
            <BarChart data={featureImportance} layout="vertical">
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis type="number" stroke="#64748b" style={{ fontSize: '10px' }} />
              <YAxis dataKey="feature" type="category" stroke="#64748b" style={{ fontSize: '9px' }} width={85} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
              <Bar dataKey="importance" fill="#06b6d4" radius={[0, 8, 8, 0]} />
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>

      <div className="bg-white p-4 rounded-lg shadow-sm">
        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Completion vs Binge</h3>
        <p className="text-xs text-slate-600 mb-4">Per-persona scatter with axis labels</p>
        <ResponsiveContainer width="100%" height={280}>
          <ScatterChart>
            <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
            <XAxis type="number" dataKey="completion" name="Completion %" stroke="#64748b" style={{ fontSize: '10px' }} label={{ value: 'Completion %', position: 'insideBottom', offset: -5, style: { fontSize: '11px' } }} />
            <YAxis type="number" dataKey="retention" name="Binge %" stroke="#64748b" style={{ fontSize: '10px' }} label={{ value: 'Binge %', angle: -90, position: 'insideLeft', style: { fontSize: '11px' } }} />
            <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} cursor={{ strokeDasharray: '3 3' }} />
            <Scatter name="Content" data={contentData} fill="#8b5cf6">
              {contentData.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={`hsl(${index * 60}, 70%, 55%)`} />
              ))}
            </Scatter>
          </ScatterChart>
        </ResponsiveContainer>
      </div>
    </div>
  );

  const renderCohortTab = () => (
    <div className="space-y-4 md:space-y-6">
      <div className="bg-white p-4 rounded-lg shadow-sm">
        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">DAU Trend</h3>
        <p className="text-xs text-slate-600 mb-4">Last 30 days with weekend spikes</p>
        <ResponsiveContainer width="100%" height={280}>
          <AreaChart data={dauData}>
            <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
            <XAxis dataKey="day" stroke="#64748b" style={{ fontSize: '10px' }} />
            <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
            <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
            <Legend wrapperStyle={{ fontSize: '10px' }} />
            <Area type="monotone" dataKey="dau" stroke="#8b5cf6" fill="#8b5cf6" fillOpacity={0.6} strokeWidth={3} name="DAU" />
          </AreaChart>
        </ResponsiveContainer>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Series Drop-off Curve</h3>
          <p className="text-xs text-slate-600 mb-4">Episode-wise median completion for Originals</p>
          <ResponsiveContainer width="100%" height={250}>
            <LineChart data={dropOffData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis dataKey="episode" stroke="#64748b" style={{ fontSize: '10px' }} label={{ value: 'Episode', position: 'insideBottom', offset: -5, style: { fontSize: '11px' } }} />
              <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
              <Line type="monotone" dataKey="completion" stroke="#ef4444" strokeWidth={3} dot={{ fill: '#ef4444', r: 5 }} name="Completion %" />
            </LineChart>
          </ResponsiveContainer>
        </div>

        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Cohort Retention (W1-W8)</h3>
          <p className="text-xs text-slate-600 mb-4">Monthly acquisition cohort</p>
          <ResponsiveContainer width="100%" height={250}>
            <LineChart data={cohortRetentionData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis dataKey="week" stroke="#64748b" style={{ fontSize: '10px' }} />
              <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
              <Line type="monotone" dataKey="retention" stroke="#10b981" strokeWidth={3} dot={{ fill: '#10b981', r: 5 }} name="Retention %" />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );

  const renderContentTab = () => (
    <div className="space-y-4 md:space-y-6">
      <div className="bg-white p-4 rounded-lg shadow-sm">
        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Genre Share (AVOD vs SVOD)</h3>
        <p className="text-xs text-slate-600 mb-4">Watch-time share split by AVOD/SVOD</p>
        <ResponsiveContainer width="100%" height={280}>
          <ComposedChart data={contentData}>
            <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
            <XAxis dataKey="category" stroke="#64748b" style={{ fontSize: '10px' }} />
            <YAxis yAxisId="left" stroke="#64748b" style={{ fontSize: '10px' }} />
            <YAxis yAxisId="right" orientation="right" stroke="#64748b" style={{ fontSize: '10px' }} />
            <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
            <Legend wrapperStyle={{ fontSize: '10px' }} />
            <Bar yAxisId="left" dataKey="avod" fill="#a5b4fc" radius={[8, 8, 0, 0]} name="AVOD share %" />
            <Bar yAxisId="left" dataKey="svod" fill="#c4b5fd" radius={[8, 8, 0, 0]} name="SVOD share %" />
            <Line yAxisId="right" type="monotone" dataKey="completion" stroke="#8b5cf6" strokeWidth={3} name="Sub conversion %" dot={{ fill: '#8b5cf6', r: 4 }} />
          </ComposedChart>
        </ResponsiveContainer>
      </div>

      <div className="bg-white p-4 rounded-lg shadow-sm">
        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Top Titles (by Watch Hours)</h3>
        <p className="text-xs text-slate-600 mb-3">Includes AVOD/SVOD and delta vs prior period</p>
        <div className="overflow-x-auto">
          <table className="w-full text-xs">
            <thead>
              <tr className="border-b border-slate-200">
                <th className="text-left py-2 px-2 font-semibold text-slate-700">Title</th>
                <th className="text-left py-2 px-2 font-semibold text-slate-700">Genre</th>
                <th className="text-right py-2 px-2 font-semibold text-slate-700">Watch Hours</th>
                <th className="text-right py-2 px-2 font-semibold text-slate-700">Change</th>
                <th className="text-right py-2 px-2 font-semibold text-slate-700">Completion %</th>
                <th className="text-right py-2 px-2 font-semibold text-slate-700">AVOD %</th>
                <th className="text-right py-2 px-2 font-semibold text-slate-700">SVOD %</th>
              </tr>
            </thead>
            <tbody>
              {contentData.map((item, idx) => (
                <tr key={idx} className="border-b border-slate-100 hover:bg-slate-50">
                  <td className="py-2 px-2 font-medium text-slate-800">Original · {item.category} Series</td>
                  <td className="py-2 px-2 text-slate-600">{item.category}</td>
                  <td className="py-2 px-2 text-right font-semibold text-slate-800">{item.watchHours.toLocaleString()}</td>
                  <td className="py-2 px-2 text-right">
                    <span className={`font-semibold ${idx % 2 === 0 ? 'text-green-600' : 'text-red-600'}`}>
                      {idx % 2 === 0 ? '+' : '-'}{Math.floor(Math.random() * 800) + 200}
                    </span>
                  </td>
                  <td className="py-2 px-2 text-right text-slate-700">{item.completion}%</td>
                  <td className="py-2 px-2 text-right text-slate-700">{item.avod}%</td>
                  <td className="py-2 px-2 text-right text-slate-700">{item.svod}%</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Genre Transition Matrix</h3>
          <p className="text-xs text-slate-600 mb-4">Next-session probabilities</p>
          <div className="overflow-x-auto">
            <div className="grid grid-cols-7 gap-1 text-xs">
              <div></div>
              {['Drama', 'Action', 'Comedy', 'Thriller', 'Kids', 'Sports'].map((label, idx) => (
                <div key={idx} className="text-xs font-semibold text-slate-700 text-center p-1">
                  {label}
                </div>
              ))}
              {['Drama', 'Action', 'Comedy', 'Thriller', 'Kids', 'Sports'].map((from, rowIdx) => (
                <React.Fragment key={from}>
                  <div className="text-xs font-semibold text-slate-700 flex items-center p-1">{from}</div>
                  {['Drama', 'Action', 'Comedy', 'Thriller', 'Kids', 'Sports'].map((to, colIdx) => {
                    const transition = genreTransition.find(t => t.from === from && t.to === to);
                    const value = transition ? transition.value : 10;
                    return (
                      <div 
                        key={colIdx}
                        className="aspect-square rounded flex items-center justify-center text-xs font-medium"
                        style={{ 
                          backgroundColor: `rgba(139, 92, 246, ${value / 100})`,
                          color: value > 30 ? '#fff' : '#1e293b'
                        }}
                      >
                        {Math.round(value)}
                      </div>
                    );
                  })}
                </React.Fragment>
              ))}
            </div>
          </div>
        </div>

        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Language Mix</h3>
          <p className="text-xs text-slate-600 mb-4">Audience by primary language</p>
          <ResponsiveContainer width="100%" height={250}>
            <BarChart data={languageMix} layout="vertical">
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis type="number" stroke="#64748b" style={{ fontSize: '10px' }} />
              <YAxis dataKey="language" type="category" stroke="#64748b" style={{ fontSize: '10px' }} width={60} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
              <Bar dataKey="value" radius={[0, 8, 8, 0]} name="Share %">
                {languageMix.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={entry.color} />
                ))}
              </Bar>
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );

  const renderEngagementTab = () => (
    <div className="space-y-4 md:space-y-6">
      <div className="bg-white p-4 rounded-lg shadow-sm">
        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Engagement Heatmap</h3>
        <p className="text-xs text-slate-600 mb-4">Watch-hour intensity by day and hour</p>
        <div className="overflow-x-auto">
          <div className="inline-block min-w-full">
            <div className="grid gap-0.5" style={{ gridTemplateColumns: 'repeat(25, minmax(0, 1fr))' }}>
              <div></div>
              {Array.from({ length: 24 }, (_, i) => (
                <div key={i} className="text-center" style={{ fontSize: '9px' }}>
                  {i}
                </div>
              ))}
              {['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map(day => (
                <React.Fragment key={day}>
                  <div className="text-xs font-semibold text-slate-700 flex items-center pr-2">{day}</div>
                  {heatmapData
                    .filter(d => d.day === day)
                    .map((cell, idx) => (
                      <div
                        key={idx}
                        className="aspect-square rounded-sm"
                        style={{
                          backgroundColor: `rgba(139, 92, 246, ${cell.intensity / 100})`
                        }}
                      />
                    ))}
                </React.Fragment>
              ))}
            </div>
          </div>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Content Performance Matrix</h3>
          <p className="text-xs text-slate-600 mb-4">Engagement vs Retention by Genre</p>
          <ResponsiveContainer width="100%" height={280}>
            <ScatterChart>
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis 
                type="number" 
                dataKey="engagement" 
                name="Engagement" 
                stroke="#64748b" 
                style={{ fontSize: '10px' }} 
                domain={[60, 100]}
                label={{ value: 'Engagement Score', position: 'insideBottom', offset: -5, style: { fontSize: '11px' } }}
              />
              <YAxis 
                type="number" 
                dataKey="retention" 
                name="Retention" 
                stroke="#64748b" 
                style={{ fontSize: '10px' }} 
                domain={[60, 95]}
                label={{ value: 'Retention %', angle: -90, position: 'insideLeft', style: { fontSize: '11px' } }}
              />
              <Tooltip 
                contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }}
                content={({ active, payload }) => {
                  if (active && payload && payload.length) {
                    const data = payload[0].payload;
                    return (
                      <div className="bg-slate-900 text-white p-2 rounded-lg text-xs">
                        <div className="font-bold mb-1">{data.category}</div>
                        <div>Engagement: {data.engagement.toFixed(1)}</div>
                        <div>Retention: {data.retention}%</div>
                        <div>Watch Hours: {data.watchHours.toLocaleString()}</div>
                      </div>
                    );
                  }
                  return null;
                }}
              />
              <Scatter name="Genres" data={contentData}>
                {contentData.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={`hsl(${index * 60}, 70%, 55%)`} />
                ))}
              </Scatter>
            </ScatterChart>
          </ResponsiveContainer>
          <div className="mt-3 grid grid-cols-3 gap-2 text-xs">
            {contentData.map((item, idx) => (
              <div key={idx} className="flex items-center">
                <div className="w-3 h-3 rounded-full mr-2" style={{ backgroundColor: `hsl(${idx * 60}, 70%, 55%)` }}></div>
                <span className="text-slate-700">{item.category}</span>
              </div>
            ))}
          </div>
        </div>

        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Entry vs Completion by Genre</h3>
          <p className="text-xs text-slate-600 mb-4">Share of first-session entries vs completions</p>
          <ResponsiveContainer width="100%" height={280}>
            <BarChart data={contentData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis dataKey="category" stroke="#64748b" style={{ fontSize: '10px' }} />
              <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
              <Legend wrapperStyle={{ fontSize: '10px' }} />
              <Bar dataKey="retention" fill="#a5b4fc" radius={[8, 8, 0, 0]} name="Entry %" />
              <Bar dataKey="completion" fill="#8b5cf6" radius={[8, 8, 0, 0]} name="Completion %" />
            </BarChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );

  const renderRFMTab = () => (
    <div className="space-y-4 md:space-y-6">
      <div className="bg-white p-4 rounded-lg shadow-sm">
        <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">RFM Segmentation</h3>
        <p className="text-xs text-slate-600 mb-4">Recency × Frequency × Monetary</p>
        <ResponsiveContainer width="100%" height={350}>
          <ScatterChart>
            <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
            <XAxis 
              type="number" 
              dataKey="x" 
              name="Frequency" 
              stroke="#64748b" 
              style={{ fontSize: '10px' }}
              domain={[0, 100]}
              label={{ value: 'Frequency →', position: 'insideBottom', offset: -5, style: { fontSize: '11px' } }}
            />
            <YAxis 
              type="number" 
              dataKey="y" 
              name="Recency" 
              stroke="#64748b" 
              style={{ fontSize: '10px' }}
              domain={[0, 100]}
              label={{ value: 'Recency ↑', angle: -90, position: 'insideLeft', style: { fontSize: '11px' } }}
            />
            <Tooltip 
              contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }}
              content={({ active, payload }) => {
                if (active && payload && payload.length) {
                  const data = payload[0].payload;
                  return (
                    <div className="bg-slate-900 text-white p-2 rounded-lg text-xs">
                      <div className="font-bold mb-1">{data.segment}</div>
                      <div>Share: {data.size}%</div>
                    </div>
                  );
                }
                return null;
              }}
            />
            <Scatter name="Segments" data={rfmData}>
              {rfmData.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={entry.color} />
              ))}
            </Scatter>
          </ScatterChart>
        </ResponsiveContainer>
        <div className="mt-4 grid grid-cols-2 md:grid-cols-4 gap-3">
          {rfmData.map((seg, idx) => (
            <div key={idx} className="flex items-center text-xs">
              <div className="w-4 h-4 rounded-full mr-2" style={{ backgroundColor: seg.color }}></div>
              <div>
                <div className="font-semibold text-slate-800">{seg.segment}</div>
                <div className="text-slate-600">{seg.size}%</div>
              </div>
            </div>
          ))}
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Champions — Genre Mix</h3>
          <p className="text-xs text-slate-600 mb-4">What they watch the most</p>
          <ResponsiveContainer width="100%" height={200}>
            <BarChart data={contentData.slice(0, 4)} layout="vertical">
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis type="number" stroke="#64748b" style={{ fontSize: '10px' }} />
              <YAxis dataKey="category" type="category" stroke="#64748b" style={{ fontSize: '10px' }} width={60} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
              <Bar dataKey="watchHours" fill="#8b5cf6" radius={[0, 8, 8, 0]} name="Watch Hours" />
            </BarChart>
          </ResponsiveContainer>
        </div>

        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Derived Attributes for Champions</h3>
          <p className="text-xs text-slate-600 mb-4">Relative strengths</p>
          <ResponsiveContainer width="100%" height={200}>
            <RadarChart data={signalRadarData}>
              <PolarGrid stroke="#e2e8f0" />
              <PolarAngleAxis dataKey="attribute" style={{ fontSize: '10px' }} />
              <PolarRadiusAxis angle={90} domain={[0, 100]} style={{ fontSize: '10px' }} />
              <Radar name="Strength" dataKey="value" stroke="#8b5cf6" fill="#8b5cf6" fillOpacity={0.6} strokeWidth={2} />
            </RadarChart>
          </ResponsiveContainer>
        </div>

        <div className="bg-white p-4 rounded-lg shadow-sm">
          <h3 className="text-sm md:text-base font-bold text-slate-800 mb-2">Retention vs Acquisition</h3>
          <p className="text-xs text-slate-600 mb-4">Segment trajectory</p>
          <ResponsiveContainer width="100%" height={200}>
            <LineChart data={cohortRetentionData}>
              <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
              <XAxis dataKey="week" stroke="#64748b" style={{ fontSize: '10px' }} />
              <YAxis stroke="#64748b" style={{ fontSize: '10px' }} />
              <Tooltip contentStyle={{ fontSize: '12px', backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }} />
              <Line type="monotone" dataKey="retention" stroke="#10b981" strokeWidth={3} dot={{ fill: '#10b981', r: 4 }} name="Retention %" />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4 md:p-6">
      <div className="mb-6">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-2xl md:text-4xl font-bold text-slate-800 mb-1">OTT Intelligence Hub</h1>
            <p className="text-sm text-slate-600">WebEngage Data Science Platform</p>
          </div>
          <div className="px-3 py-1.5 md:px-4 md:py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg text-xs md:text-sm font-semibold">
            Live Analytics
          </div>
        </div>

        <div className="flex overflow-x-auto mb-4 bg-white rounded-lg shadow-sm p-1">
          {tabs.map(tab => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={`px-3 md:px-4 py-2 text-xs md:text-sm font-semibold rounded-lg whitespace-nowrap transition-all ${
                activeTab === tab.id
                  ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-sm'
                  : 'text-slate-600 hover:text-slate-800 hover:bg-slate-50'
              }`}
            >
              {tab.label}
            </button>
          ))}
        </div>

        <div className="grid grid-cols-2 md:grid-cols-4 gap-3 bg-white p-4 rounded-lg shadow-sm">
          <div>
            <label className="block text-xs font-medium text-slate-700 mb-1">Date Range</label>
            <select 
              value={dateRange} 
              onChange={(e) => setDateRange(e.target.value)}
              className="w-full px-2 py-1.5 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
              <option value="7d">7 Days</option>
              <option value="30d">30 Days</option>
              <option value="90d">90 Days</option>
              <option value="1y">1 Year</option>
            </select>
          </div>
          <div>
            <label className="block text-xs font-medium text-slate-700 mb-1">Platform</label>
            <select 
              value={platform} 
              onChange={(e) => setPlatform(e.target.value)}
              className="w-full px-2 py-1.5 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
              <option value="all">All</option>
              <option value="Netflix">Netflix</option>
              <option value="Prime Video">Prime</option>
              <option value="Disney+">Disney+</option>
              <option value="Hulu">Hulu</option>
            </select>
          </div>
          <div>
            <label className="block text-xs font-medium text-slate-700 mb-1">Region</label>
            <select 
              value={region} 
              onChange={(e) => setRegion(e.target.value)}
              className="w-full px-2 py-1.5 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
              <option value="all">All</option>
              <option value="North America">N. America</option>
              <option value="Europe">Europe</option>
              <option value="Asia Pacific">APAC</option>
              <option value="Latin America">LATAM</option>
            </select>
          </div>
          <div>
            <label className="block text-xs font-medium text-slate-700 mb-1">Plan</label>
            <select 
              value={plan} 
              onChange={(e) => setPlan(e.target.value)}
              className="w-full px-2 py-1.5 text-sm border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            >
              <option value="all">All</option>
              <option value="Basic">Basic</option>
              <option value="Standard">Standard</option>
              <option value="Premium">Premium</option>
            </select>
          </div>
        </div>
      </div>

      {activeTab === 'summary' && renderSummaryTab()}
      {activeTab === 'derived' && renderDerivedTab()}
      {activeTab === 'cohort' && renderCohortTab()}
      {activeTab === 'content' && renderContentTab()}
      {activeTab === 'engagement' && renderEngagementTab()}
      {activeTab === 'rfm' && renderRFMTab()}

      <div className="mt-6 text-center text-xs text-slate-500">
        <p>© 2024 WebEngage Data Science Platform • Real-time Predictive Analytics for OTT</p>
      </div>
    </div>
  );
};

export default OTTDataScienceDashboard;
